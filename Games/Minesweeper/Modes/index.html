<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minesweeper Game</title>
    <style>
        body {
            background-color: #2c3e50;
            font-family: Arial, sans-serif;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        
        .container {
            text-align: center;
        }

        h1 {
            font-size: 36px;
        }

        #game-board {
            display: grid;
            gap: 5px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .cell {
            width: 40px;
            height: 40px;
            background-color: #34495e;
            border: 1px solid #2980b9;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .cell.revealed {
            background-color: #1abc9c;
            cursor: default;
        }

        .cell.flagged {
            background-color: #e74c3c;
        }

        .cell.mine {
            background-color: #e74c3c;
        }

        .cell.zero {
            background-color: #16a085;
        }

        .cell.number {
            background-color: #1abc9c;
            color: black;
        }

        .mine-count {
            font-size: 18px;
        }

        .game-over {
            font-size: 24px;
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="game-title">Minesweeper</h1>
        <div class="mine-count">Mines: <span id="mine-count">20</span></div>
        <div id="game-board"></div>
        <div id="status" class="game-over"></div>
    </div>

    <script>
        // Function to parse URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                mode: params.get('mode'),
                name: decodeURIComponent(params.get('name')),
                size: parseInt(params.get('size')),
                mines: parseInt(params.get('mines')),
                minePercentage: parseFloat(params.get('minePercentage'))
            };
        }

        const { name, size, mines, minePercentage } = getUrlParams();

        // Set the title and header based on the name from URL
        document.title = `Minesweeper - ${name}`;
        document.getElementById('game-title').textContent = `Minesweeper - ${name}`;

        // Adjust the size of the board dynamically based on the `size` parameter
        const boardSize = size;
        const mineCount = mines;
        let minesArray = [];
        let revealedCells = [];
        let flaggedCells = [];
        let gameOver = false;

        // Display the board size on the page
        document.querySelector('.mine-count').textContent = `Mines: ${mineCount}`;
        
        // Function to generate the game board
        function generateBoard() {
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            minesArray = [];
            revealedCells = [];
            flaggedCells = [];

            const rows = boardSize;
            const cols = boardSize;
            const totalCells = rows * cols;
            const cellSize = Math.floor(500 / rows);  // Set cell size relative to the board size

            // Set grid styles dynamically
            board.style.gridTemplateColumns = `repeat(${cols}, ${cellSize}px)`;
            board.style.gridTemplateRows = `repeat(${rows}, ${cellSize}px)`;

            // Generate the cells
            for (let i = 0; i < totalCells; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.setAttribute('data-index', i);
                cell.addEventListener('click', handleCellClick);
                cell.addEventListener('contextmenu', handleCellFlag);
                board.appendChild(cell);
            }

            placeMines();
            calculateNumbers();
        }

        // Function to place mines randomly on the board
        function placeMines() {
            while (minesArray.length < mineCount) {
                const randomIndex = Math.floor(Math.random() * (boardSize * boardSize));
                if (!minesArray.includes(randomIndex)) {
                    minesArray.push(randomIndex);
                }
            }
        }

        // Function to calculate surrounding mine numbers for each cell
        function calculateNumbers() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                const index = parseInt(cell.getAttribute('data-index'));
                if (minesArray.includes(index)) {
                    return;
                }

                const surroundingMines = countSurroundingMines(index);
                if (surroundingMines > 0) {
                    cell.dataset.number = surroundingMines;
                }
            });
        }

        // Function to count mines surrounding a given cell
        function countSurroundingMines(index) {
            const row = Math.floor(index / boardSize);
            const col = index % boardSize;
            let mineCount = 0;

            const directions = [
                [-1, 0], [1, 0], [0, -1], [0, 1],
                [-1, -1], [-1, 1], [1, -1], [1, 1]
            ];

            directions.forEach(([dr, dc]) => {
                const newRow = row + dr;
                const newCol = col + dc;
                if (newRow >= 0 && newRow < boardSize && newCol >= 0 && newCol < boardSize) {
                    const newIndex = newRow * boardSize + newCol;
                    if (minesArray.includes(newIndex)) {
                        mineCount++;
                    }
                }
            });

            return mineCount;
        }

        // Function to handle cell click event
        function handleCellClick(event) {
            if (gameOver) return;
            const cell = event.target;
            const index = parseInt(cell.getAttribute('data-index'));

            if (flaggedCells.includes(index)) return;

            if (minesArray.includes(index)) {
                revealMines();
                gameOver = true;
                document.getElementById('status').textContent = 'Game Over';
                return;
            }

            revealCell(cell, index);
        }

        // Function to handle cell flag event (right-click)
        function handleCellFlag(event) {
            event.preventDefault();
            if (gameOver) return;
            const cell = event.target;
            const index = parseInt(cell.getAttribute('data-index'));

            if (revealedCells.includes(index)) return;

            if (flaggedCells.includes(index)) {
                flaggedCells = flaggedCells.filter(id => id !== index);
                cell.classList.remove('flagged');
            } else {
                flaggedCells.push(index);
                cell.classList.add('flagged');
            }
        }

        // Function to reveal all mines when the game is over
        function revealMines() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                const index = parseInt(cell.getAttribute('data-index'));
                if (minesArray.includes(index)) {
                    cell.classList.add('mine');
                }
            });
        }

        // Function to reveal a cell
        function revealCell(cell, index) {
            if (revealedCells.includes(index)) return;

            revealedCells.push(index);
            cell.classList.add('revealed');

            const surroundingMines = cell.dataset.number;
            if (surroundingMines) {
                cell.textContent = surroundingMines;
                cell.classList.add('number');
            } else {
                cell.classList.add('zero');
                revealSurroundingCells(index);
            }
        }

        // Function to recursively reveal surrounding cells with no mines
        function revealSurroundingCells(index) {
            const row = Math.floor(index / boardSize);
            const col = index % boardSize;

            const directions = [
                [-1, 0], [1, 0], [0, -1], [0, 1],
                [-1, -1], [-1, 1], [1, -1], [1, 1]
            ];

            directions.forEach(([dr, dc]) => {
                const newRow = row + dr;
                const newCol = col + dc;
                if (newRow >= 0 && newRow < boardSize && newCol >= 0 && newCol < boardSize) {
                    const newIndex = newRow * boardSize + newCol;
                    const cell = document.querySelector(`.cell[data-index="${newIndex}"]`);
                    if (!revealedCells.includes(newIndex)) {
                        revealCell(cell, newIndex);
                    }
                }
            });
        }

        generateBoard();
    </script>
</body>
</html>
